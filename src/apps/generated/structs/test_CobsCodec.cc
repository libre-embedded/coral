/**
 * \file
 * \brief Generated by ifgen (4.6.3).
 */

#ifdef NDEBUG
#undef NDEBUG
#endif

#include "generated/structs/CobsCodec.h"
#include <cassert>
#include <cstring>
#include <iostream>

template <std::endian endianness> void test_CobsCodec_encode_decode_basic(void)
{
    using namespace Coral;

    CobsCodec src = {};
    assert(src.span().size() == CobsCodec::size);

    /* Eventually, we could assign member values here. */

    CobsCodec::Buffer buffer;
    assert(src.encode<endianness>(&buffer) == CobsCodec::size);

    CobsCodec dst;
    assert(dst.decode<endianness>(&buffer) == CobsCodec::size);
    assert(src == dst);

    /* Verify the values transferred. */

    /* Test stream interactions. */
    static constexpr std::size_t len = 10;
    byte_array<CobsCodec::size * len> streambuf;
    using TestSpan = byte_span<CobsCodec::size * len>;
    auto stream = byte_spanstream(TestSpan(streambuf));

    stream << dst;
    stream.seekg(0);

    CobsCodec from_stream;
    stream >> from_stream;
}

/**
 * A unit test for structs CobsCodec.
 *
 * \return 0 on success.
 */
int main(void)
{
    using namespace Coral;

    test_CobsCodec_encode_decode_basic<std::endian::native>();
    test_CobsCodec_encode_decode_basic<std::endian::little>();
    test_CobsCodec_encode_decode_basic<std::endian::big>();

    return 0;
}
